@{
    ViewBag.Title = "Member";
}
<style title="" type="text/css">
    table col.c1 {
        width: 45px;
    }

    table col.c2 {
        width: 45px;
    }

    table col.c3 {
        width: 150px;
    }

    table col.c4 {
        width: 150px;
    }

    table col.c5 {
        width: 50px;
    }
    table col.c6 {
        width: 100px;
    }
    table col.c7 {
        width: 100px;
    }
    table col.c8 {
        width: 100px;
    }
    table col.c9 {
        width: 100px;
    }
    table col.c10 {
        width: 100px;
    }
    table col.c11 {
        width: auto;
    }
    .control-label.col-md-4 {
        white-space: nowrap;
    }
</style>
<section class="content-header">
    <!--<h1>
        Top Navigation
    </h1>-->
    <ol class="breadcrumb">
        <li><a href="Home"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Member</a></li>
    </ol>
</section>
<section class="content">
    <!--S box-->
    <div class="box">
        <div class="box-header with-border">
            <h3 class="box-title">Search</h3>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
                    <i class="fa fa-minus"></i>
                </button>
            </div>
        </div>
        <div class="box-body">
            <div class="row">
                <!--S Row 1-->
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="control-label col-md-4">Name on card</label>
                        <div class="col-md-8">
                            <input type="text" name="name_on_card" placeholder="Input name" id="name_on_card" class="searchs form-control tab-event" />
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="control-label col-md-4">Card number</label>
                        <div class="col-md-8">
                            <input type="text" name="credit_card_number" placeholder="Input card number" id="credit_card_number" class="searchs form-control tab-event" />
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="control-label col-md-4">CVV</label>
                        <div class="col-md-8">
                            <input type="text" name="cvv" placeholder="Input cvv" id="cvv" class="searchs form-control tab-event" />
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mtop10">
                    <div class="form-group">
                        <label class="control-label col-md-4">Expdate</label>
                        <div class="col-md-8">
                            <input type="text" name="expdate" placeholder="Input expdate" id="expdate" class="searchs form-control tab-event" />
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mtop10">
                    <div class="form-group">
                        <label class="control-label col-md-4">Password</label>
                        <div class="col-md-8">
                            <input type="text" name="password" placeholder="Input password" id="password" class="searchs form-control tab-event" />
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mtop10">
                    <div class="form-group">
                        <label class="control-label col-md-4">Country</label>
                        <div class="col-md-8">
                            <input type="text" name="country" placeholder="Input country" id="country" class="searchs form-control tab-event" />
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mtop10">
                    <div class="form-group">
                        <label class="control-label col-md-4">Zip code</label>
                        <div class="col-md-8">
                            <input type="text" name="zipcode" placeholder="Input zipcode" id="zipcode" class="searchs form-control tab-event" />
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mtop10">
                    <div class="form-group">
                        <label class="control-label col-md-4">Status</label>
                        <div class="col-md-8">
                            <select name="isactive" id="isactive" class="combos tab-event">
                                <option value=""></option>
                                <option value="1">Active</option>
                                <option value="0">inActive</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!--E Row 1-->
            </div>
        </div>
        <!-- /.box-body -->
    </div><!--E box-->
    <!--S box-->
    <div class="box">
        <div class="box-header with-border">
            <h3 class="box-title box-title-found">
                Found <span id="totals">0</span> results
            </h3>
            <div class="box-tools pull-right">
                <ul class="button-group pull-right btnpermission">
                    <li id="search">
                        <button class="button">
                            <i class="fa fa-search"></i>
                            Search
                        </button>
                    </li>
                    <li id="refresh">
                        <button class="button">
                            <i class="fa fa-refresh"></i>
                            Refresh
                        </button>
                    </li>
                    <li id="edit">
                        <button class="button">
                            <i class="fa fa-save"></i>
                            Edit
                        </button>
                    </li>
                    <li id="delete">
                        <button type="button" class="button">
                            <i class="fa fa-times"></i>
                            Delete
                        </button>
                    </li>
                </ul>
            </div>
        </div>
        <div class="box-body">
            <!--E Grid View Data-->
            <div id="gridviewData">
                <!--header-->
                <div id="cHeader">
                    <div id="tHeader">
                        <table width="100%" cellspacing="0" border="1" class="table ">
                            @{
                                for (var i = 1; i < 12; i++)
                                {
                                    <col class="c@{@i}">
                                }
                            }

                            <tr>
                                <th><input type="checkbox" id="checkAll" autocomplete="off" /></th>
                                <th>No.</th>
                                <th>Name on card</th>
                                <th>Card number</th>
                                <th>CVV</th>
                                <th>Expdate</th>
                                <th>Country</th>
                                <th>Zip code</th>
                                <th>Status</th>
                                <th>Charge</th>
                                <th></th>
                            </tr>
                        </table>
                    </div>
                </div>
                <!--end header-->
                <!--body-->
                <div id="data">
                    <div id="gridView">
                        <table id="group" width="100%" cellspacing="0" border="1">
                            @{
                                for (var i = 1; i < 12; i++)
                                {
                                    <col class="c@{@i}">
                                }
                            }
                            <tbody id="gridRows"></tbody>
                        </table>
                    </div>
                </div>
                <!--end body-->
            </div><!--E Grid View Data-->
        </div>
        <!-- /.box-body -->
        <div class="box-footer">
            &nbsp;
        </div>
        <!-- /.box-footer-->
    </div><!--E box-->
</section>
<div class="loading" style="display: none;">
    <div class="blockUI blockOverlay" style="width: 100%;height: 100%;top:0px;left:0px;position: absolute;background-color: rgb(0,0,0);opacity: 0.1;z-index: 1000;">
    </div>
    <div class="blockUI blockMsg blockElement" style="width: 30%;position: absolute;top: 15%;left:35%;text-align: center;">
        <img src="@Url.Content("~/Content/images/preloader.gif")" style="z-index: 2;position: absolute;" />
    </div>
</div>
<input type="hidden" name="id" id="id" />
<script type="text/javascript">
    var func = "@Url.Action("getUniqueID")";
    var cpage = 0;
    var search = null;
    var table = "pilot_member";
    var username = "@ViewBag.username";
    $(function () {
        firebase.initializeApp(config);
        $('.loading').show();
        
        init();
        getListSearch();
        $("#search").click(function () {
            $('.loading').show();
            getListSearch();
        });
        $("#refresh").click(function () {
            refresh();
        });
        $("#save").click(function () {
            save();
        });
        $("#edit").click(function () {
            edit();
        });
        $("#delete").click(function () {
            deletes();
        });
      
    });
    function save() {
        var arr = getUniqueID();
        var config_key = $('#config_key').val();
        var config_value = $('#config_value').val();
        var config_name = $('#config_name').val();
        if (config_name == "") {
            warning("Config name can not be empty"); return false;
        }
        if (config_key == "") {
             warning("Config key can not be empty"); return false;
        }
        if (config_value == "") {
            warning("Config value can not be empty"); return false;
        }
        var id = arr.uniqueid;

        firebase.database().ref(table + '/' + id).set({
            id: id,
            config_name:config_name,
            config_key: config_key,
            config_value: config_value,
            datecreate: arr.timeNow,
            usercreate: username,
            isdelete:0
        });
        success("Add successfully");
    }
    function getListSearch() {
        $("#gridRows").html("");
        var ref = firebase.database().ref(table).limitToLast(1000);
        ref = ref.orderByChild('id'); //Sap xep tang
        var i = 0;
        ref.on('child_added', function (snapshot) {
            var message = snapshot.val();
            var key = snapshot.key;
            i++;
            renderData(key, message,i)
        });
        /*ref.on('child_changed', function (snapshot) {
            var message = snapshot.val();
            var key = snapshot.key;
            i++;
            renderData(key, message, i)
        });*/
    }
    function renderData(key, message, i) {
        var status = "";
        if (parseInt(message.isactive) == 1) {
            status = '<i style="color:#489fdf;" class="fa fa-check" aria-hidden="true"></i>';
        }
        else {
            status = '<i style="color:red;" class="fa fa-times" aria-hidden="true"></i>';
        }
        var ischarge = "";
        if (parseInt(message.ischarge) == 1) {
            ischarge = '<i style="color:#489fdf;" class="fa fa-check" aria-hidden="true"></i>';
        }
        else {
            ischarge = '';
        }
        var html = "";
        html += '<tr class="edit" id="' + key + '" status="' + message.status + '" >';
        html += '<td class="text-center"><input id="' + key + '" class="" type="checkbox" value="' + key + '" name="keys[]"></td>';
        html += '<td class="text-center">'+i+'</td>';
        html += '<td id="name_on_card_' + key + '"  class="config_name">' + message.name_on_card + '</td>';

        html += '<td id="credit_card_number_' + key + '" class="credit_card_number">' + message.credit_card_number + '</td>';
        html += '<td id="cvv_' + key + '" class="cvv">' + message.cvv + '</td>';
        html += '<td id="expdate_' + expdate + '" class="expdate">' + message.expdate + '</td>';
        html += '<td id="country_' + country + '" class="country">' + message.country + '</td>';
        html += '<td id="zipcode_' + zipcode + '" class="zipcode">' + message.zipcode + '</td>';
        html += '<td class="text-center">' + status + '</td>';
        html += '<td class="text-center">' + ischarge + '</td>';
        html += '<td></td>';
        html += '</tr>';
        $("#gridRows").append(html);
        $('.loading').hide();
    }
    function edit() {
        var arr = getUniqueID();
        var config_key = $('#config_key').val();
        var config_value = $('#config_value').val();
        var config_name = $('#config_name').val();
        if (config_name == "") {
            warning("Config name can not be empty"); return false;
        }
        if (config_key == "") {
            warning("Config key can not be empty"); return false;
        }
        if (config_value == "") {
            warning("Config value can not be empty"); return false;
        }
        var id = $('#id').val();
        var updates = {};
        updates[table + "/" + id + "/config_key"] = config_key;
        updates[table + "/" + id + "/config_value"] = config_value;
        updates[table + "/" + id + "/config_name"] = config_name;
        updates[table + "/" + id + "/datecreate"] = arr.timeNow;
        updates[table + "/" + id + "/userupdate"] = username;
        firebase.database().ref().update(updates);

        $("#config_key_" + id).html(config_key);
        $("#config_value_" + id).html(config_value);
        $("#config_name_" + id).html(config_name);

        success("Edit successfully");
    }
    function init() {
        $(document.body).on("click", ".edit", function () {
            var index = $(".edit").index($(this));
            var id = $(".edit").eq(index).attr("id");
            var config_name = $(".config_name").eq(index).html();
            var config_key = $(".config_key").eq(index).html();
            var config_value = $(".config_value").eq(index).html();
            $('#config_name').val(config_name);
            $('#config_key').val(config_key);
            $('#config_value').val(config_value);
            $('#id').val(id);
        });
        $("#isactive").multipleSelect({
            filter: true,
            placeholder: 'Select a status',
            single: true
        });
    }
    function refresh() {
        $(".searchs").val("");
    }
    function getUniqueID() {
        var arr = [];
        var id = randomNumberFromRange(100, 1000000000000000000);
        $.ajax({
            url: func,
            async: false,
            type: 'POST',
            dataType: 'JSON',
            data: { uniqueid: id },
            success: function (obj) {
                arr.uniqueid = obj.uniqueid;
                arr.timeNow = obj.timeNow;
            }
        });
        return arr;
    }
    function randomNumberFromRange(min, max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
    }
</script>